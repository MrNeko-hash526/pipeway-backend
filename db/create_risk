-- Risk Management Main Table
CREATE TABLE risk_management (
    id INT AUTO_INCREMENT PRIMARY KEY,
    criteria_id INT NOT NULL,
    rrm_option TEXT NOT NULL,
    rrm_level INT NOT NULL,
    rrm_exception VARCHAR(500) NOT NULL,
    status ENUM('Active', 'Inactive') DEFAULT 'Active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_criteria_id (criteria_id),
    INDEX idx_rrm_level (rrm_level),
    INDEX idx_status (status),
    FOREIGN KEY (criteria_id) REFERENCES rrm_criteria(id) ON DELETE CASCADE
);

-- RRM Criteria Lookup Table
CREATE TABLE rrm_criteria (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(500) NOT NULL UNIQUE,
    status ENUM('Active', 'Inactive') DEFAULT 'Active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_name (name),
    INDEX idx_status (status)
);

-- RRM Levels Configuration Table
CREATE TABLE rrm_levels (
    id INT AUTO_INCREMENT PRIMARY KEY,
    level_value INT NOT NULL UNIQUE,
    level_label VARCHAR(100) NOT NULL,
    range_min INT NULL,
    range_max INT NULL,
    status ENUM('Active', 'Inactive') DEFAULT 'Active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_level_value (level_value),
    INDEX idx_status (status)
);

-- Insert default criteria
INSERT INTO rrm_criteria (name, status) VALUES 
('Total Value of Exposure/Risk (volume of records exposed)', 'Active'),
('Physical Safety of Employees/Guests & Vendors', 'Active'),
('Data Security Risk', 'Active'),
('Operational Impact', 'Active');

-- Insert default levels
INSERT INTO rrm_levels (level_value, level_label, range_min, range_max, status) VALUES 
(1, '1 (Low 0-6)', 0, 6, 'Active'),
(2, '2 (Medium 7-12)', 7, 12, 'Active'),
(3, '3 (High 13-18)', 13, 18, 'Active');

-- Insert sample risk management entries
INSERT INTO risk_management (criteria_id, rrm_option, rrm_level, rrm_exception, status) VALUES 
(1, 'Greater than $5,000,000', 3, 'Vendor Compliance Committee', 'Active'),
(1, '$500,001-$5,000,000', 2, 'President', 'Active'),
(1, 'Less than $500,000', 1, 'Director of Operations', 'Active'),
(2, 'Risk High/Injury Potential High', 3, 'Oversight, Governance and Audit Committee', 'Active');